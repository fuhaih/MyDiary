# 扫码登录

# 项目结构

 -- Host api 控制器层
 ---- Application 业务

 # abp项目的授权管理

 # ca认证

 出现的问题
 
 * 签发者问题

服务器的ip是172.17.210.219，正常前端访问的是这个ip地址，所以生成的token的签发者也是这个ip地址，但是ca认证服务器和这个网段隔绝了，所以会通过网关172.28.18.19访问我们的callback接口，最终生成的token的签发者是172.28.18.19，返回给前端，导致token因为签发者问题无法使用
 

 # 依赖注入容器域中单独添加注册新的服务

 这个是使用autofac的功能

 # IdentityServer4中单独生成token

 可以注入一个IdentityServerTools服务

 ```csharp
 private readonly IdentityServerTools _tools;

//通过该工具生成一个token
 token = await _tools.IssueClientJwtAsync("pcclient", 3600 * 24 * 90, new string[]{ "api1" }, new string[] { "api1" }, claimList);

 ```