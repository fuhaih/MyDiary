# 索引
# 聚集索引
sql数据库在默认情况下会根据主键来创建聚集索引，索引能够很大的提升数据查询的性能，但是，每次数据库的数据在插入和删除的时候，需要维护索引，所以索引会影响数据库的插入和删除的效率，所以最理想的情况是在查询频繁，数据更新少的表中创建索引。
## 聚集索引与插入操作

最简单的情况下，插入操作根据索引找到对应的数据页，然后通过挪动已有的记录为新数据腾出
空间，最后插入数据。
如果数据页已满，则需要拆分数据页（页拆分是一种耗费资源的操作，一般数据库系统中会有相
应的机制要尽量减少页拆分的次数，通常是通过为每页预留空间来实现）：
* A）在该使用的数据段（extent ）上分配新的数据页，如果数据段已满，则需要分配新段。
* B）调整索引指针，这需要将相应的索引页读入内存并加锁。
* C）大约有一半的数据行被归入新的数据页中。
* D）如果表还有非聚集索引，则需要更新这些索引指向新的数据页。
特殊情况：
* A）如果新插入的一条记录包含很大的数据，可能会分配两个新数据页，其中之一用来存储新记
录，另一存储从原页中拆分出来的数据。
* B）通常数据库系统中会将重复的数据记录存储于相同的页中。
* C）类似于自增列为聚集索引的，数据库系统可能并不拆分数据页，页只是简单的新添数据页。

## 聚集索引与删除操作

删除行将导致其下方的数据行向上移动以填充删除记录造成的空白。
如果删除的行是该数据页中的最后一行，那么该数据页将被回收，相应的索引页中的记录将被删
除。如果回收的数据页位于跟该表的其它数据页相同的段上，那么它可能在随后的时间内被利用。
如果该数据页是该段的唯一一个数据页，则该段也被回收。
对于数据的删除操作，可能导致索引页中仅有一条记录，这时，该记录可能会被移至邻近的索引
页中，原索引页将被回收，即所谓的“索引合并”。


# 事务